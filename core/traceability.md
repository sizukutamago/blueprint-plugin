# トレーサビリティルール

## 概要

設計ドキュメント間の追跡可能性を保証するためのルール。
全ての要件（FR/NFR）が設計成果物に反映され、逆方向の追跡も可能であることを検証する。

## トレーサビリティマップ

依存方向: FR → ENT → API → SC

```yaml
traceability:
  fr_to_sc: {}       # FR → SC: 機能要件から画面へ
  fr_to_api: {}      # FR → API: 機能要件から API へ
  fr_to_ent: {}      # FR → ENT: 機能要件からエンティティへ
  api_to_ent: {}     # API → ENT: API からエンティティへ
  api_to_sc: {}      # API → SC: API から画面へ
  fr_to_test: {}     # FR → テスト: 機能要件からテストケースへ
  nfr_to_test: {}    # NFR → テスト: 非機能要件からテストケースへ
```

## 必須トレーサビリティ

| ルール | 説明 | 重大度（違反時） |
|--------|------|----------------|
| 全 FR に SC が存在 | 全ての機能要件が最低1つの画面にマッピング | P1 |
| 全 FR に API または ENT が存在 | 全ての機能要件が API またはエンティティにマッピング | P1 |
| 画面操作に API が存在 | ユーザー操作を伴う画面には対応 API が存在 | P1 |
| API レスポンスの ENT が定義済 | API が返すエンティティが database で定義済み | P1 |
| 全 FR にテストが存在 | 全ての機能要件にテストケースがマッピング | P1 |
| 全 NFR にテストが存在 | 全ての非機能要件にテスト方法がマッピング | P1 |

## 孤児 ID 検出

| 種別 | 説明 | 重大度 |
|------|------|--------|
| 孤児 ENT | 定義されているが FR/API から参照されていない | P2 |
| 孤児 API | 定義されているが FR/SC から参照されていない | P2 |
| 孤児 SC | 定義されているが FR から参照されていない | P2 |

## 各フェーズでのトレーサビリティ責務

| フェーズ | 登録するマッピング |
|---------|------------------|
| database | fr_to_ent |
| design-inventory | fr_to_sc |
| api | fr_to_api, api_to_ent, api_to_sc |
| impl-test | fr_to_test, nfr_to_test |
